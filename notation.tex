%%%%%%%
% OLD TIM-STYLE NOTATION (for PROBE)
%%%%%%%

%% Basic bold for letters and symbols
\DeclareMathAlphabet{\mbf}{OT1}{ptm}{b}{n}
\newcommand{\mbs}[1]{\boldsymbol{#1}}
\newcommand{\mbsbar}[1]{\overline{\boldsymbol{#1}}}
\newcommand{\mbshat}[1]{\hat{\boldsymbol{#1}}}
\newcommand{\mbsvec}[1]{\underrightarrow{\boldsymbol{#1}}}
\newcommand{\mbsdel}[1]{\delta {\boldsymbol{#1}}}
\newcommand{\mbsDel}[1]{\Delta {\boldsymbol{#1}}}
\newcommand{\mbsdot}[1]{\dot {\boldsymbol{#1}}}
\newcommand{\mbsddot}[1]{\ddot {\boldsymbol{#1}}}
\newcommand{\mbfbar}[1]{\overline{\mbf{#1}}}
\newcommand{\mbfhat}[1]{\hat{\mbf{#1}}}
\newcommand{\mbfvec}[1]{\underrightarrow{\mbf{#1}}}
\newcommand{\mbfdel}[1]{\delta{\mbf{#1}}}
\newcommand{\mbfDel}[1]{\Delta{\mbf{#1}}}
\newcommand{\mbfdot}[1]{\dot{\mbf{#1}}}
\newcommand{\mbfddot}[1]{\ddot{\mbf{#1}}}

%% Zero and Identity matrices
\newcommand{\Zero}{\mbf{0}}
\newcommand{\One}{\mbf{1}}

%% Homogeneous coordinates
\DeclareMathAlphabet{\mbfh}{OML}{cmm}{b}{it}
\newcommand{\mbfhbar}[1]{\overline{\mbfh{#1}}}
\newcommand{\mbfhhat}[1]{\hat{\mbfh{#1}}}
\newcommand{\mbfhdel}[1]{\delta{\mbfh{#1}}}
\newcommand{\mbfhDel}[1]{\Delta{\mbfh{#1}}}
\newcommand{\mbfhdot}[1]{\dot{\mbfh{#1}}}
\newcommand{\mbfhddot}[1]{\ddot{\mbfh{#1}}}

%% Coordinate frames
\newcommand{\cframe}[1]{\ensuremath \underrightarrow{\mathcal{F}}_{#1}}
% Table spacing fixes
\newcommand\T{\rule{0pt}{2.6ex}}        % Top strut
\newcommand\B{\rule[-1.2ex]{0pt}{0pt}} % Bottom strut


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PROBE-GK NOTATION
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%Common math commands

\NewDocumentCommand\NaturalNumbers{oo}{%
    \IfNoValueTF{#2}
    {
        \IfNoValueTF{#1}
        {\ensuremath{\mathbb N}}
        {\ensuremath{\mathbb N^{#1}}}
    }
    { \ensuremath{\mathbb N^{#1\times #2}}}
}
\NewDocumentCommand\Integers{oo}{%
    \IfNoValueTF{#2}
    {
        \IfNoValueTF{#1}
        {\ensuremath{\mathbb Z}}
        {\ensuremath{\mathbb Z^{#1}}}
    }
    { \ensuremath{\mathbb Z^{#1\times #2}}}
}
\NewDocumentCommand\RationalNumbers{oo}{%
    \IfNoValueTF{#2}
    {
        \IfNoValueTF{#1}
        {\ensuremath{\mathbb Q}}
        {\ensuremath{\mathbb Q^{#1}}}
    }
    { \ensuremath{\mathbb Q^{#1\times #2}}}
}
\NewDocumentCommand\RealNumbers{oo}{%
    \IfNoValueTF{#2}
    {
        \IfNoValueTF{#1}
        {\ensuremath{\mathbb R}}
        {\ensuremath{\mathbb R^{#1}}}
    }
    { \ensuremath{\mathbb R^{#1\times #2}}}
}
\NewDocumentCommand\ComplexNumbers{oo}{%
    \IfNoValueTF{#2}
    {
        \IfNoValueTF{#1}
        {\ensuremath{\mathbb C}}
        {\ensuremath{\mathbb C^{#1}}}
    }
    { \ensuremath{\mathbb C^{#1\times #2}}}
}
\NewDocumentCommand\HomogeneousNumbers{oo}{%
    \IfNoValueTF{#2}
    {
        \IfNoValueTF{#1}
        {\ensuremath{\mathbb P}}
        {\ensuremath{\mathbb P^{#1}}}
    }
    { \ensuremath{\mathbb P^{#1\times #2}}}
}

\NewDocumentCommand\SOg{}{\ensuremath{\mathrm{SO}(3)} }
\NewDocumentCommand\SOa{}{\ensuremath{\mathfrak{so}(3)} }

% VP Additions 
\newcommand{\bcf}{\;\mbox{\boldmath ${\cal F}$\unboldmath}}
\def\Vec#1{\!\!\hbox{$#1$\kern-0.38em\lower0.85em\hbox{$\vec{}\,$}}\,}%
\def\ep{\epsilon}
\def\la{\lambda}
\def\om{\omega}
\newcommand{\qc}[1]{{#1}^+}
\newcommand{\qo}[1]{{#1}^\oplus}
\newcommand{\qi}[1]{{#1}^{\scalebox{0.5}{$-1$}}}
\newcommand\at[2]{\left.#1\right|_{#2}}


% Matrices

\NewDocumentCommand\Identity{o}{% 
    \IfNoValueTF{#1}
    {\ensuremath{\mathbbm 1}}
    {\ensuremath{\mathbbm 1_{#1}}}
}
% Variables for this document
\NewDocumentCommand\HomogeneousPoint{mm}{\boldsymbol{p}_{#1,#2}}
\nomenclature{$\HomogeneousPoint{i}{t}\in\HomogeneousNumbers[3]$}{Location of visual landmark i during frame t in homogeneous coordinates.}%
 \NewDocumentCommand\HomogeneousPointEstimate{mm}{\bar{\boldsymbol{p}}_{#1,#2}}
 
\NewDocumentCommand\VisualLandmark{mm}{\Vector{z}_{#1,#2}}
\nomenclature{$\VisualLandmark{i}{t}\in\RealNumbers[3]$}{Location of visual
  landmark $i$ in the global coordinate frame during image frame $t$}%

\NewDocumentCommand\CameraPose{m}{\Vector{x}_{#1}}
\nomenclature{$\CameraPose{t}\in\text{SE}(3)$}{Camera pose at frame $t$}%

\NewDocumentCommand\ImageLandmark{mm}{\Vector{y}_{#1,#2}}
\NewDocumentCommand\LinearizedImageLandmark{mm}{\bar{\Vector{y}}_{#1,#2}}

\NewDocumentCommand\TargetImageLandmark{o}{
    \IfNoValueTF{#1}
    {\Vector{y}_{*}}
    {\Vector{y}_{*,#1}}
  }
\nomenclature{$\ImageLandmark{i}{t}\in\RealNumbers[4]$}{Location
  of visual landmark $i$ during frame $t$ in image coordinates
  for each stereo camera.}%

\NewDocumentCommand\ImageLandmarkCovariance{mm}{\Matrix{R}_{#1,#2}}
\NewDocumentCommand\Covariance{}{\Matrix{R}}

\NewDocumentCommand\TargetImageLandmarkCovariance{}{\Matrix{R}_*}
\nomenclature{$\ImageLandmarkCovariance{i}{t}\in\RealNumbers[4\times
  4]\succ 0$}{Location
  of visual landmark $i$ during frame $t$ in image coordinates
  for each stereo camera.}%

\NewDocumentCommand\Predictor{mm}{\Vector{\phi}_{#1,#2}}
\nomenclature{$\Predictor{i}{t}$}{Predictor features for image-space
  landmark $i$ in frame $t$}%

\NewDocumentCommand\TargetPredictor{}{\Vector{\phi}_*}
\nomenclature{$\Predictor{i}{t}$}{Predictor features for image-space
  landmark $i$ in frame $t$}%

\NewDocumentCommand\TargetTransform{}{\mathcal{T}_*}
\nomenclature{$\Transform_t=\Transform(\CameraPose{t})$}{The operator which
  applies a frame transform to a vector, so that $\Transform_t
  \VisualLandmark{i}{t}$ is the location of visual landmark $i$ relative to the
  camera coordinate frame.}

\NewDocumentCommand\ProjectionFunction{}{f}
\nomenclature{$\ProjectionFunction:
  \RealNumbers[3]\to\RealNumbers[4]$}{Function mapping a visual landmark in
  the camera coordinate frame to image coordinates, so that
  $\ProjectionFunction( \VisualLandmark{i}{t}) =
  \ImageLandmark{i}{t}$. This function is invertible, so that
  $\ProjectionFunction^{-1}( \ImageLandmark{i}{t}) =
  \VisualLandmark{i}{t}$.}%

\NewDocumentCommand\NormalDistribution{}{\mathcal{N}}
\nomenclature{$\NormalDistribution\left(\Vector{x};
    \Vector{\mu},\Matrix{\Sigma}\right)$}{A multivariate normal distribution
  with mean $\Vector{\mu}\in\RealNumbers[d]$ and covariance
  $\Matrix{\Sigma}\in\RealNumbers[d\times d]\succ\Matrix{0}$: 
  \begin{equation*}
    \NormalDistribution\left(\Vector{x};\Vector{\mu},\Matrix{\Sigma}\right)
    = (2\pi)^{-\frac{d}{2}}\vert\Matrix{\Sigma}\vert^{-\frac{1}{2}}
    \exp\left( -\frac{1}{2}
      \Transpose{(\Vector{x}-\Vector{\mu})} \Matrix{\Sigma}^{-1}
      (\Vector{x}-\Vector{\mu}) \right)
  \end{equation*}  
}

\NewDocumentCommand\InverseWishartDistribution{}{\text{IW}}
\nomenclature{$\InverseWishartDistribution\left(\Matrix{R};
    \Matrix{\Psi},\nu\right)$}{An inverse Wishart distribution 
  with scale matrix $\Matrix{\Psi}\in\RealNumbers[d\times d]\succ\Matrix{0}$
  and degrees of freedom $\nu>d-1$.  
  \begin{equation*}
    \InverseWishartDistribution\left(\Matrix{R}; \Matrix{\Psi}, \nu\right)
    = \frac{\vert\Matrix{\Psi}\vert^{\frac{\nu}{2}}}{2^{\frac{\nu
          d}{2}}\Gamma_d(\frac{\nu}{2})}
    \vert\Matrix{R}\vert^{-\frac{\nu+d+1}{2}}
    \exp\left( -\frac{1}{2}
      \Trace{\Matrix{\Psi}\Matrix{R}^{-1}}\right)
  \end{equation*}  
}

\NewDocumentCommand\StudentTDistribution{}{\text{t}}
\nomenclature{$\StudentTDistribution_{\nu}\left(\Vector{x}; \Vector{\mu},
    \Matrix{\Sigma}\right)$}{ A multivariate student's $t$-distributon with mean
  $\Vector{\mu}\in\RealNumbers[d]$, covariance $\Matrix{\Sigma} \in
  \RealNumbers[d\times d] \succ\Matrix{0}$, and degrees of freedom $\nu>0$.  
  \begin{equation*} 
    \StudentTDistribution_{\nu}\left(\Vector{x}; \Vector{\mu},
      \Matrix{\Sigma}\right) =
    \frac{\Gamma(\frac{\nu+d}{2})}{\Gamma(\frac{\nu}{2})}
    \vert\Matrix{\Sigma}\vert^{-\frac{1}{2}}(\nu\pi)^{-\frac{d}{2}}
    \left(1+\frac{1}{\nu}
      \Transpose{(\Vector{x}-\Vector{\mu})} \Matrix{\Sigma}^{-1}
      (\Vector{x}-\Vector{\mu}) \right)^{-\frac{\nu+d}{2}}
  \end{equation*}  
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% SUN-BCNN
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NewDocumentCommand\SunDirectionComponent{}{s}
\NewDocumentCommand\SunDirection{}{\Vector{\SunDirectionComponent}}
\NewDocumentCommand\SunDirectionAll{}{\Matrix{S}}
\NewDocumentCommand\SunImage{}{\Vector{x}}
\NewDocumentCommand\SunImageAll{}{\Matrix{X}}

\NewDocumentCommand\CNNVariationalWeight{}{\boldsymbol{w}}
\NewDocumentCommand\CNNWeightAll{}{\Matrix{M}}

\NewDocumentCommand\AzimuthAngle{}{\phi}
\NewDocumentCommand\ZenithAngle{}{\theta}

\NewDocumentCommand\KeypointComponent{}{p}
\NewDocumentCommand\Keypoint{}{\Vector{\KeypointComponent}}
\NewDocumentCommand\CameraObservation{}{\Vector{y}}
\NewDocumentCommand\CameraModel{m}{\Vector{g}\left(#1\right)}

\NewDocumentCommand\Error{}{\Vector{e}}

\NewDocumentCommand\CNNLoss{m}{\mathcal{L}\left(#1\right)}
\NewDocumentCommand\BACost{}{\mathcal{J}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% DPC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NewDocumentCommand\deltap{}{\Delta_p}
\NewDocumentCommand\TargetVOTransform{}{\Transform_{i,i+\deltap}}
\NewDocumentCommand\EstimatedVOTransform{}{\Estimate{\Transform}_{i,i+\deltap}}
\NewDocumentCommand\EstimatedVOTransformNoSub{}{\Estimate{\Transform}}



\NewDocumentCommand\TargetCorrection{}{\Transform^*}
\NewDocumentCommand\TargetCorrectionIndex{}{\Transform^*_i}

\NewDocumentCommand\TargetCorrectionVector{}{\TransformVector^*}
\NewDocumentCommand\TargetCorrectionVectorIndex{}{\TransformVector^*_i}

\NewDocumentCommand\TargetCorrectionRotation{}{\Rotation_*}
\NewDocumentCommand\TargetCorrectionRotationVector{}{\RotationVector_*}

\NewDocumentCommand\LeftJacobianSE{}{ \Matrix{\mathcal{J}} }
\NewDocumentCommand\LeftJacobianSO{}{ \Matrix{J} }
\NewDocumentCommand\LogMapFunction{m}{g({#1})}
\NewDocumentCommand\LogMapFunctionSO{m}{f({#1})}

\NewDocumentCommand\EstimatedVOTransformCorrected{}{\EstimatedVOTransform^{\text{corr}}}
\NewDocumentCommand\EstimatedVOTransformCorrectedNoSub{}{\EstimatedVOTransformNoSub^{\mathrm{corr}}}

\NewDocumentCommand\PredictionVector{}{\TransformVector}
\NewDocumentCommand\PredictionVectorIndex{}{\TransformVector_i}

\NewDocumentCommand\TransformCovariance{}{\Matrix{\Sigma}}


\NewDocumentCommand\CostFunction{}{\mathcal{L}}
\NewDocumentCommand\PoseCostFunction{}{\mathcal{O}}

\NewDocumentCommand\MatLn{m}{\text{ln}\left({#1} \right)^{\vee}}
\NewDocumentCommand\MatExp{m}{\text{exp}\left({#1}^{\wedge}\right)}
\NewDocumentCommand\Inv{m}{{#1}^{-1}}

\NewDocumentCommand\definedtobe{}{\triangleq}
\NewDocumentCommand\Image{}{\Vector{I}}
\NewDocumentCommand\ImageQuad{}{\Image}


\newlength\fsep
\setlength\fsep{1\fboxsep+2\fboxrule}
\newsavebox\widebox
\newenvironment{mathbox}
{\par\vskip\fsep\noindent%
 \begin{lrbox}{\widebox}%
 \begin{minipage}{\columnwidth-\fsep}%
}{\vskip\fsep\end{minipage}\end{lrbox}
  \framebox{\usebox\widebox}%
 }


%\NewDocumentCommand\ProjectionFunction{}{\pi}
%\NewDocumentCommand\ImageLandmarkCovariance{mm}{\Matrix{R}_{#1,#2}}
\NewDocumentCommand\ImageCovariance{}{\Matrix{\Sigma_y}}
%\NewDocumentCommand\ImageLandmark{mm}{\Vector{y}_{#1,#2}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Basic shortcuts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Matrices and vectors
\newcommand\bbm[0]{ \begin{bmatrix} }
\newcommand\ebm[0]{ \end{bmatrix} }
\newcommand\Vector[1]{ \boldsymbol{\mathbf{#1}} }
\newcommand\VectorArrow[1]{\underrightarrow{#1}}
\newcommand\Matrix[1]{ \boldsymbol{\mathbf{#1}} }
\newcommand\Transpose[1]{ \left.{#1}\right.^T }
\newcommand\ConjugateTranspose[1]{ \left.{#1}\right.^H }
\newcommand\Trace[1]{ \mathrm{tr}\left(#1\right) }
\newcommand\Determinant[1]{ \mathrm{det}\left(#1\right) }
\newcommand\Norm[1]{\left\Vert#1\right\Vert }
\newcommand\Diag[1]{ \mathrm{diag} \left\{ #1 \right\} }

%% Calculus
\newcommand\dd[0]{ \mathop[0]\!\mathrm{d} }
\newcommand\PartialDerivative[2]{ \dfrac{\partial #1}{\partial #2} }
\newcommand\OrdinaryDerivative[2]{ \dfrac{\dd #1}{\dd #2} }

%% Optimization
\newcommand\ArgMax[1]{ \operatorname*{argmax}_{#1} }
\newcommand\ArgMin[1]{ \operatorname*{argmin}_{#1} }

%% Sets
\newcommand\Set[1]{ \left\{#1\right\} }
\newcommand\Real[0]{ \mathbb{R} }
\newcommand\Complex[0]{ \mathbb{C} }

%% Lie groups and Lie algebras
\newcommand\LieGroupSO[1]{ \mathrm{SO}(#1) }
\newcommand\LieAlgebraSO[1]{ \mathfrak{so}(#1) }
\newcommand\LieGroupSE[1]{ \mathrm{SE}(#1) }
\newcommand\LieAlgebraSE[1]{ \mathfrak{se}(#1) }
\newcommand\LieGroupSim[1]{ \mathrm{Sim}(#1) }
\newcommand\LieAlgebraSim[1]{ \mathfrak{sim}(#1) }
\newcommand\LieGroupAdjoint[1]{ \mathrm{Ad}\left(#1\right) }
\newcommand\LieAlgebraAdjoint[1]{ \mathrm{ad}\left(#1\right) }

%% Statistics and stochastic processes
\newcommand\Expectation[1]{ \mathbb{E}\left[#1\right] }
%\newcommand\NormalDistribution[2]{ \mathcal{N}\left(#1,#2\right) }
\newcommand\GaussianProcess[2]{ \mathcal{GP}\left(#1,#2\right) }

%% Miscellaneous
\newcommand\AbsoluteValue[1]{ \left\vert#1\right\vert }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% UTIAS Notation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Zero and Identity matrices
\newcommand\ZeroMatrix[0]{ \Matrix{0} }
\newcommand\IdentityMatrix[0]{ \Matrix{1} }

%% Coordinate frames and transformations
\newcommand\CoordinateFrame[1]{ \underrightarrow{\Matrix{\mathcal{F}}}_{#1} }
\newcommand\Rotation[0]{ \Matrix{C} }
\newcommand\RotationVector[0]{ \Vector{\phi} }
\newcommand\Transform[0]{ \Matrix{T} }
\newcommand\TransformVector[0]{ \Vector{\xi} }

%% Variable decorations
\newcommand\Estimate[1]{\hat{#1}}
\newcommand\Prior[1]{\check{#1}}
\newcommand\Mean[1]{\overline{#1}}
\newcommand\Optimal[1]{{#1}^*}